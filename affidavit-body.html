<!-- affidavit-body.html — Paragraph editor + previews + export actions (with per-row RTE) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Affidavit Body</title>
  <link rel="stylesheet" href="style.css">
  <!-- Optional: PDF.js (for auto page count)
       <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.min.js"></script>
  -->
</head>
<body class="page-affidavit-body ui-modern">
  <main>
    <section>
      <!-- Top toolbar -->
      <div class="toolbar">
        <button id="back">◀ Back</button>
        <div>
          <button id="exportTxt">Export Affidavit (TXT)</button>
          <button id="exportAffPdf">Export Affidavit (PDF)</button>
          <button id="exportExhPdf">Export Exhibits Package (PDF)</button>
          <button id="exportFullPdf">Export Full Package (PDF)</button>
        </div>
      </div>

      <!-- Live previews -->
      <div class="card" id="heading"></div>
      <div class="card" id="intro"></div>

      <!-- Affidavit Body Editor -->
      <div class="card">
        <h1>Affidavit Body</h1>
        <p class="muted">
          Add paragraphs. Use <strong>“Move to paragraph”</strong> to change their order; exhibits relabel automatically (A, B, C…).
        </p>

        <!-- Controls toolbar -->
        <div class="controls">
          <button id="addParaEnd">+ Add paragraph</button>

          <div class="controls-right">
            <button id="undoBtn" disabled>Undo last action</button>
            <button id="redoBtn" disabled>Redo last undo</button>

            <!-- Exhibit Label Scheme Toggle (letters on left, numbers on right) -->
            <div class="scheme-control" id="schemeControl" title="Toggle exhibit label style" role="group" aria-label="Exhibit label style">
              <span class="scheme-label">Exhibit labels:</span>
              <span class="scheme-opt" id="optLetters">Letters</span>
              <label class="switch">
                <input type="checkbox" id="schemeToggle" aria-label="Toggle exhibit labels between letters and numbers">
                <span class="slider"></span>
              </label>
              <span class="scheme-opt" id="optNumbers">Numbers</span>
            </div>
          </div>
        </div>

        <!-- Paragraph rows -->
        <div id="paraList"></div>
      </div> <!-- end Affidavit Body card -->

      <!-- Jurat (blank; exported after paragraphs) -->
      <div class="card" id="jurat"></div>
      <!-- Backsheet (Form 4C) -->
      <div class="card" id="backsheet"></div>
    </section>
  </main>

  <!-- Export Options Modal -->
  <div id="exportModal" class="modal" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="exportModalTitle">
      <h3 id="exportModalTitle">Export options</h3>

      <form id="exportForm">
        <div class="field">
          <label for="exportDate">Sworn date (optional)</label>
          <input type="date" id="exportDate" name="exportDate">
          <div class="mt-6">
            <label>
              <input type="checkbox" id="exportNoDate">
              This affidavit has no sworn date yet (I will write it in after export)
            </label>
          </div>
        </div>

 <div class="field">
  <p class="muted">
    The backsheet (Form 4C) is the last sheet required on every document filed
    with the court. It sets out essential information such as the court file
    number, the type of document being filed, and the party or lawyer who is
    filing it, as required by Rule 4.02(3) of the Rules of Civil Procedure.
  </p>

  <label>
    <input type="checkbox" id="exportExcludeBack">
    Exclude backsheet (Form 4C) from this export
  </label>
</div>


      </form>

      <div class="modal-actions">
        <button id="exportCancel" type="button">Cancel</button>
        <button id="exportConfirm" type="button">Continue</button>
      </div>
    </div>
  </div>

  <!-- Exhibit Scheme Modal -->
  <div id="schemeModal" class="modal" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="schemeTitle">
      <h3 id="schemeTitle">Exhibit label style</h3>
      <p>How should exhibits be labeled in the exported PDF?</p>

      <form id="schemeForm">
        <label class="radio">
          <input type="radio" name="scheme" value="letters" checked>
          Letters (A, B, C…)
        </label>
        <label class="radio">
          <input type="radio" name="scheme" value="numbers">
          Numbers (1, 2, 3…)
        </label>
      </form>

      <div class="modal-actions">
        <button id="schemeCancel" type="button">Cancel</button>
        <button id="schemeOk" type="button">Continue</button>
      </div>
    </div>
  </div>

  <!-- Document Intake Modal (opens once per uploaded file) -->
  <div id="docMetaModal" class="modal" aria-hidden="true">
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="docMetaTitle">
      <h3 id="docMetaTitle">Describe your document</h3>
      <div id="docMetaGuidance" class="guidance" aria-live="polite"></div>
      <form id="docMetaForm"></form>
      <div id="docMetaErrors" class="form-errors" role="alert" aria-live="assertive"></div>
      <div class="modal-actions">
        <button id="docMetaSave" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- PDF-lib (global PDFLib used by affidavit-export.js) -->
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

  <!-- App modules -->
  <script type="module" src="affidavit-body.js"></script>
  <script type="module" src="affidavit-export.js"></script>
</body>
</html>
